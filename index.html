<html>
  <head>

    <title>Supergen - Chess</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta charset="UTF-8"/>

    <link rel="stylesheet" href="src/css/index.css" type="text/css"/>
    <link rel="stylesheet" href="src/css/utils.css" type="text/css"/>

    <script src="src/js/ChessBoard.class.js"></script>
    <script src="src/js/ChessGame.class.js"></script>
    <script src="src/js/Move.class.js"></script>
    <script src="src/js/Turn.class.js"></script>
    <script src="src/js/Position.class.js"></script>

    <script type="text/javascript">

      var chess;


      window.onload = function(){

        init();
        init_listeners();

      };

      function init(){

        let c_board = document.getElementById("c-board"), c_field;

        for(let i = 0; i < 8; i++){

          for(let j = 0; j < 8; j++){

            c_field = document.createElement("c-field");

            if((i + j) % 2 == 0){

              c_field.setAttribute("class", "white_field");

            }else{

              c_field.setAttribute("class", "black_field");

            }

            c_board.appendChild(c_field);

          }

        }

        chess = new ChessGame();

        this.chess.board.updatePieces();

      }
      function init_listeners(){

        window.onmouseup = function(e){

          let x = Math.floor((e.clientX - chess.domBoard.offsetLeft)/64);
          let y = Math.floor((e.clientY - chess.domBoard.offsetTop)/64);

          if(!chess.isThreatenedField(x, y)){
            chess.setPiece(new Position(x, y), chess.PIECES.BLACK_QUEEN);
            chess.board.updatePieces();
          }else{

            alert("geht nicht");

          }

        };

      }

    </script>
  </head>
  <body>
    <hidden-piece id="hidden-piece"></hidden-piece>
    <c-board id="c-board">
    </c-board>
  </body>
</html>
